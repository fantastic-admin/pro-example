
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as L}from"./index-ClELmDgR.js";import{d as M,ap as E,aq as N,b9 as R,s as q,n as A,c as n,o as i,f as v,b as u,M as O,g as _,_ as G,i as H,t as x,e as p,A as w,F as P,q as J,l as y,a4 as K,w as z,m as Q,at as S,L as B,bi as W}from"./index-H6QnEWHf.js";import{f as T}from"./filesize-Csas5AuA.js";const X={class:"space-y-2"},Y=["disabled"],Z={class:"text-sm text-card-foreground/70"},ee={class:"cursor-pointer text-primary font-bold"},te=["multiple","disabled"],ae={key:0,class:"flex flex-wrap gap-1 text-xs text-card-foreground/50 empty:hidden"},se={key:0,class:"after:content-[';_'] last:after:content-empty"},oe={key:1,class:"after:content-[';_'] last:after:content-empty"},ie={key:2,class:"after:content-[';_'] last:after:content-empty"},le={key:1,class:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2"},re=["onClick"],ne={class:"flex-1 truncate"},de={class:"truncate text-sm font-medium"},ce={class:"text-xs text-card-foreground/50"},ue={key:1,class:"size-10 flex-center"},pe={key:2,class:"size-10 flex-center"},fe=M({name:"FaFileUpload",__name:"index",props:E({action:{},method:{default:"post"},headers:{default:()=>({})},data:{default:()=>({})},name:{default:"file"},afterUpload:{},multiple:{type:Boolean,default:!1},ext:{default:()=>[]},size:{default:10*1024*1024},max:{default:0},hideTips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:E(["onSuccess","onClick"],["update:modelValue"]),setup(h,{emit:b}){const e=h,C=b,l=N(h,"modelValue"),{t:f}=R(),k=q("fileInputRef"),g=A(!1);function j(a){a.preventDefault(),!e.disabled&&(g.value=!0)}function $(a){a.preventDefault(),g.value=!1}function V(a){var o;a.preventDefault(),!e.disabled&&(g.value=!1,(o=a.dataTransfer)!=null&&o.files&&D(a.dataTransfer.files))}function D(a){var c;if(!a)return;const o=Array.from(a),r=e.max>0?e.max-l.value.length:o.length,d=[];for(const t of o.slice(0,r)){if(e.ext.length>0){const s=(c=t.name.split(".").pop())==null?void 0:c.toLowerCase();if(!e.ext.map(m=>m.toLowerCase()).includes(s||"")){B.error(f("typeError",{ext:e.ext.join(" / ")}));continue}}if(e.size>0&&t.size>e.size){B.error(f("sizeError",{size:T(e.size,{standard:"jedec"})}));continue}d.push(t)}k.value.value="",d.forEach(t=>F(t))}function F(a,o){const r=new FormData;Object.entries(e.data).forEach(([t,s])=>{r.append(t,s)}),r.append(e.name,a);let d={};e.headers instanceof Headers?e.headers.forEach((t,s)=>{d[s]=t}):d={...e.headers},o===void 0&&l.value.push({name:a.name,size:a.size,status:"uploading",progress:0,file:a});const c=o!=null?o:l.value.length-1;W({url:e.action,method:e.method,headers:d,data:r,onUploadProgress:t=>{t.total&&(l.value[c].progress=Math.round(t.loaded*100/t.total))}}).then(async t=>{var m;const s=await((m=e.afterUpload)==null?void 0:m.call(e,t.data));s&&(l.value[c].url=s),C("onSuccess",t.data,a),l.value[c].status="success"}).catch(()=>{l.value[c].status="error"})}function I(a){l.value.splice(a,1)}return(a,o)=>{const r=G,d=Q,c=L;return i(),n("div",X,[v("button",{type:"button",class:w(["h-40 w-full flex flex-col cursor-pointer items-center justify-center border border-2 rounded-lg border-dashed bg-transparent p-4 transition-all",{"border-primary bg-primary/5":p(g),"opacity-50 cursor-not-allowed":e.disabled||e.max>0&&l.value.length>=e.max}]),disabled:e.disabled||e.max>0&&l.value.length>=e.max,onDragover:j,onDragleave:$,onDrop:V,onClick:o[1]||(o[1]=t=>{var s;return(s=p(k))==null?void 0:s.click()})},[O(a.$slots,"default",{},()=>[_(r,{name:"i-icon-park-outline:upload",class:"mb-2 text-2xl text-card-foreground/50"}),v("div",Z,[H(x(p(f)("uploadDragTips")),1),v("span",ee,x(p(f)("uploadClickTips")),1)])]),v("input",{ref_key:"fileInputRef",ref:k,type:"file",multiple:e.multiple,disabled:e.disabled,class:"hidden",onChange:o[0]||(o[0]=t=>D(t.target.files))},null,40,te)],42,Y),!e.hideTips&&!e.disabled?(i(),n("div",ae,[e.ext.length>0?(i(),n("div",se,x(p(f)("extTip",{ext:e.ext.join(" / ")})),1)):u("",!0),e.size>0?(i(),n("div",oe,x(p(f)("sizeTip",{size:p(T)(e.size,{standard:"jedec"})})),1)):u("",!0),e.max>0?(i(),n("div",ie,x(p(f)("countTip",{max:e.max})),1)):u("",!0)])):u("",!0),l.value.length>0?(i(),n("div",le,[(i(!0),n(P,null,J(l.value,(t,s)=>(i(),n("div",{key:t.name+s,class:w(["group/file-upload-item relative flex items-center gap-2 border rounded-lg py-2 pe-2 ps-3",[t.status==="error"?"border-red-500 bg-red-500/10":""]]),onClick:m=>C("onClick",t,s)},[v("div",ne,[v("div",de,x(t.name),1),v("div",ce,x(p(T)(t.size,{standard:"jedec"})),1)]),t.status==="uploading"?(i(),n("div",{key:0,class:"pointer-events-none absolute inset-0 z-0 bg-primary/5",style:K({width:"".concat(t.progress,"%")})},null,4)):t.status==="success"?(i(),n("div",ue,[_(r,{name:"i-ix:upload-success",class:"text-lg text-green-600"})])):t.status==="error"?(i(),n("div",pe,[_(r,{name:"i-ix:upload-fail",class:"text-lg text-red-600"})])):u("",!0),e.disabled?u("",!0):(i(),y(c,{key:3,class:"absolute inset-e-2 top-1/2 opacity-0 transition-opacity -translate-y-1/2 group-hover/file-upload-item:opacity-100"},{default:z(()=>[t.status==="error"?(i(),y(d,{key:0,variant:"outline",size:"icon",onClick:S(m=>F(t.file,s),["stop"])},{default:z(()=>[_(r,{name:"i-icon-park-outline:upload",class:"cursor-pointer text-lg"})]),_:1},8,["onClick"])):u("",!0),t.status!=="uploading"?(i(),y(d,{key:1,variant:"outline",size:"icon",onClick:S(m=>I(s),["stop"])},{default:z(()=>[_(r,{name:"i-icon-park-outline:delete",class:"cursor-pointer text-lg text-red-500"})]),_:1},8,["onClick"])):u("",!0)]),_:2},1024))],10,re))),128))])):u("",!0)])}}});function U(h){const b=h;b.__i18n=b.__i18n||[],b.__i18n.push({locale:"",resource:{"zh-cn":{uploadDragTips:{t:0,b:{t:2,i:[{t:3}],s:"将文件拖到此处，或"}},uploadClickTips:{t:0,b:{t:2,i:[{t:3}],s:"点击上传"}},extTip:{t:0,b:{t:2,i:[{t:3,v:"支持 "},{t:4,k:"ext"},{t:3,v:" 格式"}]}},sizeTip:{t:0,b:{t:2,i:[{t:3,v:"大小不超过 "},{t:4,k:"size"}]}},countTip:{t:0,b:{t:2,i:[{t:3,v:"数量不超过 "},{t:4,k:"max"},{t:3,v:" 个"}]}},typeError:{t:0,b:{t:2,i:[{t:3,v:"上传文件只支持 "},{t:4,k:"ext"},{t:3,v:" 格式"}]}},sizeError:{t:0,b:{t:2,i:[{t:3,v:"上传文件大小不能超过 "},{t:4,k:"size"}]}},maxError:{t:0,b:{t:2,i:[{t:3,v:"上传文件数量不能超过 "},{t:4,k:"max"},{t:3,v:" 个"}]}},uploadSuccess:{t:0,b:{t:2,i:[{t:3}],s:"上传成功"}},uploadFailed:{t:0,b:{t:2,i:[{t:3}],s:"上传失败"}}},"zh-tw":{uploadDragTips:{t:0,b:{t:2,i:[{t:3}],s:"將文件拖到此處，或"}},uploadClickTips:{t:0,b:{t:2,i:[{t:3}],s:"點擊上傳"}},extTip:{t:0,b:{t:2,i:[{t:3,v:"支持 "},{t:4,k:"ext"},{t:3,v:" 格式"}]}},sizeTip:{t:0,b:{t:2,i:[{t:3,v:"大小不超過 "},{t:4,k:"size"}]}},countTip:{t:0,b:{t:2,i:[{t:3,v:"數量不超過 "},{t:4,k:"max"},{t:3,v:" 個"}]}},typeError:{t:0,b:{t:2,i:[{t:3,v:"上傳文件只支持 "},{t:4,k:"ext"},{t:3,v:" 格式"}]}},sizeError:{t:0,b:{t:2,i:[{t:3,v:"上傳文件大小不能超過 "},{t:4,k:"size"}]}},maxError:{t:0,b:{t:2,i:[{t:3,v:"上傳文件數量不能超過 "},{t:4,k:"max"},{t:3,v:" 個"}]}},uploadSuccess:{t:0,b:{t:2,i:[{t:3}],s:"上傳成功"}},uploadFailed:{t:0,b:{t:2,i:[{t:3}],s:"上傳失敗"}}},en:{uploadDragTips:{t:0,b:{t:2,i:[{t:3}],s:"Drop files here to upload, or"}},uploadClickTips:{t:0,b:{t:2,i:[{t:3}],s:"click"}},extTip:{t:0,b:{t:2,i:[{t:3,v:"Support "},{t:4,k:"ext"},{t:3,v:" format"}]}},sizeTip:{t:0,b:{t:2,i:[{t:3,v:"Size not exceeding "},{t:4,k:"size"}]}},countTip:{t:0,b:{t:2,i:[{t:3,v:"Number not exceeding "},{t:4,k:"max"}]}},typeError:{t:0,b:{t:2,i:[{t:3,v:"Upload files only support "},{t:4,k:"ext"},{t:3,v:" format"}]}},sizeError:{t:0,b:{t:2,i:[{t:3,v:"Upload file size cannot exceed "},{t:4,k:"size"}]}},maxError:{t:0,b:{t:2,i:[{t:3,v:"Upload file number cannot exceed "},{t:4,k:"max"}]}},uploadSuccess:{t:0,b:{t:2,i:[{t:3}],s:"Upload success"}},uploadFailed:{t:0,b:{t:2,i:[{t:3}],s:"Upload failed"}}}}})}typeof U=="function"&&U(fe);export{fe as _};
