
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as W,bQ as Z,bd as $,g as m,ac as j,M as T,Z as J,a1 as K,b9 as F,a4 as c,ck as X,w as Y,a as o,c as I,o as k,k as s,m as d,l as ee,N as V,v as ae,P as le,G as x,p as S,O as te,R as ne,S as oe}from"./index-Bnionyve.js";import{a as ue}from"./menu-BAkdgYHt.js";import{a as C}from"./role-DVrXwFu0.js";const se={class:"mb-2"},ce=W({__name:"index",props:{id:{default:""}},setup(U,{expose:B}){const N=U,M=Z(),{generateI18nTitle:D}=$(),g=m(!1),R=j("formRef"),t=m({id:N.id,name:"",remark:"",auths:[]}),G=m({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),f=m("frontend"),p=m([]),q=T(()=>{function n(a){return a.map(l=>{var r,h;const e={...l};if(Array.isArray(l.children)&&l.children.length>0){const _=n(l.children);_.length>0&&_.every(E=>!!E)?e.children=_:delete e.children}if((h=(r=l.meta)==null?void 0:r.auths)!=null&&h.length||e.children&&e.children.length>0)return e}).filter(Boolean)}return n(p.value)}),v=m([]);J(()=>{y(),t.value.id!==""&&P()}),K(f,()=>{y()});function y(){if(f.value==="frontend"){p.value=M.routesRaw;let n=1;const a=l=>{l.forEach((e,r)=>{var h;l[r].id=n,n++,v.value.push({id:e.id,auths:e.meta.auths||[]}),((h=e==null?void 0:e.children)==null?void 0:h.length)>0&&a(e.children)})};a(p.value)}else ue.list().then(n=>{p.value=n.data;const a=l=>{l.forEach(e=>{var r;v.value.push({id:e.id,auths:e.meta.auths}),((r=e==null?void 0:e.children)==null?void 0:r.length)>0&&a(e.children)})};a(p.value)})}function P(){g.value=!0,C.detail(t.value.id).then(n=>{g.value=!1,t.value.name=n.data.name,t.value.remark=n.data.remark,t.value.auths=n.data.auths})}const b=T(()=>{const n={};return v.value.forEach(a=>{let l=0;a.auths.forEach(e=>{t.value.auths.includes(e.value)&&l++}),n[a.id]={checkAll:l===a.auths.length,indeterminate:l>0&&l<a.auths.length}}),n});function z(n,a){n?v.value.forEach(l=>{l.id===a&&l.auths.forEach(e=>{t.value.auths.includes(e.value)||t.value.auths.push(e.value)})}):v.value.forEach(l=>{l.id===a&&l.auths.forEach(e=>{t.value.auths=t.value.auths.filter(r=>r!==e.value)})})}return B({submit(){return new Promise(n=>{var a;(a=R.value)==null||a.validate(l=>{l&&(t.value.id===""?C.create(t.value).then(()=>{F.success("模拟新增成功"),n()}):C.edit(t.value).then(()=>{F.success("模拟编辑成功"),n()}))})})}}),(n,a)=>{const l=c("ElInput"),e=c("ElFormItem"),r=c("ElSwitch"),h=le,_=c("ElTooltip"),E=c("ElTableColumn"),A=c("ElCheckbox"),H=c("ElCheckboxGroup"),L=c("ElTable"),O=c("ElForm"),Q=X("loading");return Y((k(),I("div",null,[s(O,{ref_key:"formRef",ref:R,model:o(t),rules:o(G),"label-width":"80px","label-suffix":"："},{default:d(()=>[s(e,{label:"名称",prop:"name"},{default:d(()=>[s(l,{modelValue:o(t).name,"onUpdate:modelValue":a[0]||(a[0]=u=>o(t).name=u),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),s(e,{label:"备注",prop:"remark"},{default:d(()=>[s(l,{modelValue:o(t).remark,"onUpdate:modelValue":a[1]||(a[1]=u=>o(t).remark=u),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),s(e,{label:"权限"},{default:d(()=>[ee("div",se,[s(r,{modelValue:o(f),"onUpdate:modelValue":a[2]||(a[2]=u=>ae(f)?f.value=u:null),"inactive-text":"前端路由数据","inactive-value":"frontend","active-text":"后端路由数据","active-value":"backend"},null,8,["modelValue"]),s(_,{content:"为方便演示，提供了路由数据分别从前端获取和后端获取的切换",placement:"top"},{default:d(()=>[s(h,{name:"i-ri:question-line",class:"ms-4"})]),_:1})]),(k(),V(L,{key:o(f),data:o(q),"row-key":"id",stripe:"","highlight-current-row":"","default-expand-all":"",border:"",style:{lineHeight:"normal"}},{default:d(()=>[s(E,{label:"模块"},{default:d(({row:u})=>[x(S(o(D)(u.meta.title)),1)]),_:1}),s(E,{label:"权限"},{default:d(({row:u})=>{var w;return[(w=u.meta.auths)!=null&&w.length?(k(),V(A,{key:0,modelValue:o(b)[u.id].checkAll,"onUpdate:modelValue":i=>o(b)[u.id].checkAll=i,indeterminate:o(b)[u.id].indeterminate,onChange:i=>z(i,u.id)},{default:d(()=>[...a[4]||(a[4]=[x(" 全选 ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):te("",!0),s(H,{modelValue:o(t).auths,"onUpdate:modelValue":a[3]||(a[3]=i=>o(t).auths=i)},{default:d(()=>[(k(!0),I(ne,null,oe(u.meta.auths,i=>(k(),V(A,{key:i.value,value:i.value},{default:d(()=>[x(S(i.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])]}),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"])])),[[Q,o(g)]])}}});export{ce as _};
