
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as z,x as N,B as F,r as H,c as y,o as x,A as V,e as h,f as q,l as B,b as P,g as L,_ as O,at as J,p as Q,M as U,i as K,t as W,w as j,F as R,q as G,n as D,C as X,N as Y,ak as Z}from"./index-H6QnEWHf.js";import{_}from"./index.vue_vue_type_script_setup_true_lang-Fk9DuJA6.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-q5UnQ13R.js";const te=["data-id"],ne={class:"flex-1 text-sm text-foreground"},de=z({name:"FaTreeNode",__name:"node",props:{node:{},depth:{},selectedId:{},expandedIds:{},checkable:{type:Boolean}},emits:["toggleExpand","select","checkChange"],setup(i,{emit:$}){const c=i,r=$,v=N(()=>c.expandedIds.has(c.node.id)),f=N(()=>!c.checkable&&c.selectedId===c.node.id),p=N(()=>c.node.children&&c.node.children.length>0),k=N({get:()=>I(c.node),set(s){const l=s===!0;r("checkChange",c.node,l)}});function I(s){var b;if(!((b=s.children)!=null&&b.length))return!!s.checked;const l=s.children.reduce((m,C)=>{if(C.disabled)return m.disabled++,m;const w=I(C);return w===!0?m.checked++:w==="indeterminate"&&m.indeterminate++,m},{checked:0,indeterminate:0,disabled:0});return s.children.length-l.disabled===0?!1:l.checked===s.children.length-l.disabled?!0:l.checked>0||l.indeterminate>0?"indeterminate":!1}function A(s){s.stopPropagation(),p.value&&r("toggleExpand",c.node.id,!v.value)}function T(s){if(s.stopPropagation(),!c.node.disabled){if(c.checkable){const l=!c.node.checked;r("checkChange",c.node,l);return}c.selectedId===c.node.id?r("select",""):r("select",c.node.id)}}const M=N(()=>{if(!f.value||c.checkable)return"";const s=t=>{let e=[];return t.forEach(d=>{e.push(d),d.children&&c.expandedIds.has(d.id)&&(e=[...e,...s(d.children)])}),e},l=s([c.node]),b=l.findIndex(t=>t.id===c.node.id),m=l[b-1],C=l[b+1],w=m&&c.selectedId===m.id,S=C&&c.selectedId===C.id;return F(!w&&"rounded-t-md",!S&&"rounded-b-md")});return(s,l)=>{const b=O,m=ee,C=H("FaTreeNode"),w=_;return x(),y("div",{"data-tree-node":!0,"data-id":i.node.id,class:V(h(F)("relative space-y-1",i.depth>0&&"ps-5"))},[q("div",{class:V(h(F)("relative flex items-center gap-2 min-h-8 px-2 py-1.5 ms-8 rounded-md select-none transition-colors","hover:bg-accent hover:text-accent-foreground",h(f)&&"bg-accent text-accent-foreground",i.node.disabled&&"opacity-50 cursor-not-allowed",!i.node.disabled&&"cursor-pointer",h(M))),onClick:T},[h(p)?(x(),y("div",{key:0,class:"absolute h-4 w-4 flex flex-shrink-0 items-center justify-center -inset-s-6",onClick:A},[L(b,{name:"i-lucide:chevron-down",class:V(["h-3 w-3 text-muted-foreground transition-transform",{"rotate--90 rtl:rotate-90":!h(v)}])},null,8,["class"])])):P("",!0),i.checkable?(x(),B(m,{key:1,modelValue:h(k),"onUpdate:modelValue":l[0]||(l[0]=S=>Q(k)?k.value=S:null),disabled:i.node.disabled,class:"flex-shrink-0",onClick:l[1]||(l[1]=J(()=>{},["stop"]))},null,8,["modelValue","disabled"])):P("",!0),q("div",ne,[U(s.$slots,"default",{node:i.node,expanded:h(v)},()=>[K(W(i.node.name),1)])])],2),h(p)?(x(),B(w,{key:0,"model-value":h(v),class:"mt-1 space-y-1"},{default:j(()=>[(x(!0),y(R,null,G(i.node.children,S=>(x(),B(C,{key:S.id,node:S,depth:i.depth+1,"selected-id":i.selectedId,"expanded-ids":i.expandedIds,checkable:i.checkable,onToggleExpand:l[2]||(l[2]=(g,n)=>r("toggleExpand",g,n)),onSelect:l[3]||(l[3]=g=>r("select",g)),onCheckChange:l[4]||(l[4]=(g,n)=>r("checkChange",g,n))},{default:j(({node:g,expanded:n})=>[U(s.$slots,"default",{node:g,expanded:n})]),_:3},8,["node","depth","selected-id","expanded-ids","checkable"]))),128))]),_:3},8,["model-value"])):P("",!0)],10,te)}}}),ae={key:0,class:"relative mb-4 w-full"},se=z({name:"FaTree",__name:"index",props:{data:{},checkable:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},filterPlaceholder:{default:"搜索..."},filterMethod:{},class:{}},emits:["selectionChange","checkChange"],setup(i,{expose:$,emit:c}){const r=i,v=c,f=D(new Set),p=D(null),k=D(""),I=N(()=>{const n=new Map,t=e=>{var d;n.set(e.id,e),(d=e.children)==null||d.forEach(t)};return r.data.forEach(t),n}),A=N(()=>{if(!k.value.trim())return r.data;const n=k.value.toLowerCase(),t=new Set,e=a=>r.filterMethod&&r.filterMethod(k.value,a)||a.name.toLowerCase().includes(n)?!0:a.children?a.children.some(u=>e(u)):!1,d=a=>a.map(o=>{if(!o.children)return e(o)?o:null;const u=d(o.children);return u.length>0||e(o)?(o.children&&t.add(o.id),{...o,children:u}):null}).filter(o=>o!==null);return X(()=>{k.value.trim()&&(f.value=new Set([...f.value,...t]))}),d(r.data)});function T(n){var d;const t=I.value.get(n.id);if(!t)return!1;if(!((d=t.children)!=null&&d.length))return!!t.checked;const e=t.children.reduce((a,o)=>{if(o.disabled)return a.disabled++,a;const u=T(o);return u===!0?a.checked++:u==="indeterminate"&&a.indeterminate++,a},{checked:0,indeterminate:0,disabled:0});return t.children.length-e.disabled===0?!1:e.checked===t.children.length-e.disabled?!0:e.checked>0||e.indeterminate>0?"indeterminate":!1}const M=N(()=>{if(!p.value)return null;const n=t=>{for(const e of t){if(e.id===p.value)return e;if(e.children){const d=n(e.children);if(d)return d}}return null};return n(r.data)});function s(n){let t=[];return n.forEach(e=>{e.children&&(t.push(e.id),t=[...t,...s(e.children)])}),t}function l(n,t){const e=new Set(f.value);t?e.add(n):e.delete(n),f.value=e}function b(n){r.checkable||(p.value=n)}function m(n,t){C(n.id,t),n.children&&n.children.length>0&&w(n.children,t),S(n.id),v("checkChange",g(r.data))}function C(n,t){const e=d=>{d.forEach(a=>{a.id===n&&(a.checked=t),a.children&&e(a.children)})};e(r.data)}function w(n,t){n.forEach(e=>{e.disabled||(e.checked=t,e.children&&e.children.length>0&&w(e.children,t))})}function S(n){const t=(e,d)=>{for(const a of e)if(a.children){if(a.children.some(u=>u.id===d)){const u=a.children.map(E=>E.children&&E.children.length>0?T(E):!!E.checked);return u.every(E=>E===!0)?a.checked=!0:(u.every(E=>E===!1),a.checked=!1),t(r.data,a.id),!0}if(t(a.children,d))return!0}return!1};t(r.data,n)}function g(n){const t=[],e=d=>{d.checked&&t.push(d),d.children&&d.children.forEach(e)};return n.forEach(e),t}return Y(p,()=>{r.checkable||v("selectionChange",M.value)},{deep:!0}),$({expand:n=>{if(n&&n.length>0){const t=new Set(f.value);n.forEach(e=>t.add(e)),f.value=t}else f.value=new Set(s(r.data))},collapse:n=>{if(n&&n.length>0){const t=new Set(f.value);n.forEach(e=>t.delete(e)),f.value=t}else f.value=new Set},checkAll:n=>{const t=e=>{var d;e.disabled||(m(e,n),(d=e.children)==null||d.forEach(t))};r.data.forEach(t)},setSelection:n=>{p.value=n,v("selectionChange",M.value)},clearSelection:()=>{p.value=null,v("selectionChange",null)}}),(n,t)=>{const e=O,d=Z;return x(),y("div",{class:V(h(F)("w-full",r.class))},[i.filterable?(x(),y("div",ae,[L(e,{name:"i-lucide:search",class:"absolute left-3 top-1/2 h-4 w-4 text-gray-400 -translate-y-1/2"}),L(d,{modelValue:h(k),"onUpdate:modelValue":t[0]||(t[0]=a=>Q(k)?k.value=a:null),placeholder:i.filterPlaceholder,class:"w-full ps-8"},null,8,["modelValue","placeholder"])])):P("",!0),(x(!0),y(R,null,G(h(A),a=>(x(),B(de,{key:a.id,node:a,depth:0,"selected-id":h(p),"expanded-ids":h(f),checkable:i.checkable,onToggleExpand:l,onSelect:b,onCheckChange:m},{default:j(({node:o,expanded:u})=>[U(n.$slots,"default",{node:o,expanded:u})]),_:3},8,["node","selected-id","expanded-ids","checkable"]))),128))],2)}}});export{se as _};
