
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as j,ay as J,az as K,n as m,s as O,x as F,a7 as Q,N as X,L as T,r as c,aw as Y,W as Z,e as o,c as I,o as E,g as s,w as d,f as ee,l as V,p as ae,_ as le,i as x,t as U,b as te,F as ne,q as oe}from"./index-H6QnEWHf.js";import{a as ue}from"./menu-Tj77A3rN.js";import{a as C}from"./role-Drh3e6Yh.js";const se={class:"mb-2"},ce=j({__name:"index",props:{id:{default:""}},setup(B,{expose:N}){const S=B,q=J(),{generateI18nTitle:D}=K(),k=m(!1),y=O("formRef"),t=m({id:S.id,name:"",remark:"",auths:[]}),M=m({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),f=m("frontend"),p=m([]),z=F(()=>{function n(a){return a.map(l=>{var r,h;const e={...l};if(Array.isArray(l.children)&&l.children.length>0){const _=n(l.children);_.length>0&&_.every(g=>!!g)?e.children=_:delete e.children}if((h=(r=l.meta)==null?void 0:r.auths)!=null&&h.length||e.children&&e.children.length>0)return e}).filter(Boolean)}return n(p.value)}),v=m([]);Q(()=>{R(),t.value.id!==""&&G()}),X(f,()=>{R()});function R(){if(f.value==="frontend"){p.value=q.routesRaw;let n=1;const a=l=>{l.forEach((e,r)=>{var h;l[r].id=n,n++,v.value.push({id:e.id,auths:e.meta.auths||[]}),((h=e==null?void 0:e.children)==null?void 0:h.length)>0&&a(e.children)})};a(p.value)}else ue.list().then(n=>{p.value=n.data;const a=l=>{l.forEach(e=>{var r;v.value.push({id:e.id,auths:e.meta.auths}),((r=e==null?void 0:e.children)==null?void 0:r.length)>0&&a(e.children)})};a(p.value)})}function G(){k.value=!0,C.detail(t.value.id).then(n=>{k.value=!1,t.value.name=n.data.name,t.value.remark=n.data.remark,t.value.auths=n.data.auths})}const b=F(()=>{const n={};return v.value.forEach(a=>{let l=0;a.auths.forEach(e=>{t.value.auths.includes(e.value)&&l++}),n[a.id]={checkAll:l===a.auths.length,indeterminate:l>0&&l<a.auths.length}}),n});function L(n,a){n?v.value.forEach(l=>{l.id===a&&l.auths.forEach(e=>{t.value.auths.includes(e.value)||t.value.auths.push(e.value)})}):v.value.forEach(l=>{l.id===a&&l.auths.forEach(e=>{t.value.auths=t.value.auths.filter(r=>r!==e.value)})})}return N({submit(){return new Promise(n=>{var a;(a=y.value)==null||a.validate(l=>{l&&(t.value.id===""?C.create(t.value).then(()=>{T.success("模拟新增成功"),n()}):C.edit(t.value).then(()=>{T.success("模拟编辑成功"),n()}))})})}}),(n,a)=>{const l=c("ElInput"),e=c("ElFormItem"),r=c("ElSwitch"),h=le,_=c("ElTooltip"),g=c("ElTableColumn"),w=c("ElCheckbox"),W=c("ElCheckboxGroup"),H=c("ElTable"),P=c("ElForm"),$=Y("loading");return Z((E(),I("div",null,[s(P,{ref_key:"formRef",ref:y,model:o(t),rules:o(M),"label-width":"80px","label-suffix":"："},{default:d(()=>[s(e,{label:"名称",prop:"name"},{default:d(()=>[s(l,{modelValue:o(t).name,"onUpdate:modelValue":a[0]||(a[0]=u=>o(t).name=u),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),s(e,{label:"备注",prop:"remark"},{default:d(()=>[s(l,{modelValue:o(t).remark,"onUpdate:modelValue":a[1]||(a[1]=u=>o(t).remark=u),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),s(e,{label:"权限"},{default:d(()=>[ee("div",se,[s(r,{modelValue:o(f),"onUpdate:modelValue":a[2]||(a[2]=u=>ae(f)?f.value=u:null),"inactive-text":"前端路由数据","inactive-value":"frontend","active-text":"后端路由数据","active-value":"backend"},null,8,["modelValue"]),s(_,{content:"为方便演示，提供了路由数据分别从前端获取和后端获取的切换",placement:"top"},{default:d(()=>[s(h,{name:"i-ri:question-line",class:"ms-4"})]),_:1})]),(E(),V(H,{key:o(f),data:o(z),"row-key":"id",stripe:"","highlight-current-row":"","default-expand-all":"",border:"",style:{lineHeight:"normal"}},{default:d(()=>[s(g,{label:"模块"},{default:d(({row:u})=>[x(U(o(D)(u.meta.title)),1)]),_:1}),s(g,{label:"权限"},{default:d(({row:u})=>{var A;return[(A=u.meta.auths)!=null&&A.length?(E(),V(w,{key:0,modelValue:o(b)[u.id].checkAll,"onUpdate:modelValue":i=>o(b)[u.id].checkAll=i,indeterminate:o(b)[u.id].indeterminate,onChange:i=>L(i,u.id)},{default:d(()=>[...a[4]||(a[4]=[x(" 全选 ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):te("",!0),s(W,{modelValue:o(t).auths,"onUpdate:modelValue":a[3]||(a[3]=i=>o(t).auths=i)},{default:d(()=>[(E(!0),I(ne,null,oe(u.meta.auths,i=>(E(),V(w,{key:i.value,value:i.value},{default:d(()=>[x(U(i.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])]}),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"])])),[[$,o(k)]])}}});export{ce as _};
