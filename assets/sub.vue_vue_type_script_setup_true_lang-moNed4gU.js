
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-ChpqWgwo.js";import{d as _,s as I,Q as B,x as y,B as v,r as U,c as M,o as f,F as x,g as K,l as w,b,e as n,T as j,R as O,S as V,U as N,w as T,A as Q,q as Z,V as z,C as D}from"./index-H6QnEWHf.js";import{r as G,I as J}from"./item-BMCHnayz.js";const te=_({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(r){var P;const s=r,C=I("itemRef"),H=I("subMenuRef"),t=B(G),h=(P=s.menu.path)!=null?P:t.getUseId(s.menu),k=y(()=>t.openedMenus.includes(s.uniqueKey.at(-1))),q=y(()=>t.alwaysOpenedsMenus.includes(s.uniqueKey.at(-1))),A=y(()=>t.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height="".concat(window.innerHeight,"px"))},afterEnter:()=>{},beforeLeave:e=>{e.style.maxHeight="".concat(e.offsetHeight,"px"),e.style.overflow="hidden"},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""}}:CSS.supports("height","calc-size(auto, size)")?{}:{enter(e){requestAnimationFrame(()=>{e.dataset.height=e.offsetHeight.toString(),e.style.maxHeight="0",e.offsetHeight,e.style.maxHeight="".concat(e.dataset.height,"px"),e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=""},enterCancelled(e){e.style.maxHeight="",e.style.overflow=""},beforeLeave(e){e.style.maxHeight="".concat(e.offsetHeight,"px"),e.style.overflow="hidden"},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""},leaveCancelled(e){e.style.maxHeight="",e.style.overflow=""}}),E=y(()=>t.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0"),enterToClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveToClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0")}),m=y(()=>{var e,a;return(a=(e=s.menu.children)==null?void 0:e.some(l=>{var c;return((c=l.meta)==null?void 0:c.menu)!==!1}))!=null?a:!1});function R(){var e,a;q.value||t.isMenuPopup&&m.value||(e=s.menu.meta)!=null&&e.link||(a=s.menu.meta)!=null&&a.newWindow||requestAnimationFrame(()=>{m.value?t.handleSubMenuClick(h,s.uniqueKey):t.handleMenuItemClick(h)})}let u;function $(){t.isMenuPopup&&(t.mouseInMenu=s.uniqueKey,u==null||u(),{stop:u}=z(()=>{if(m.value)t.openMenu(h,s.uniqueKey),D(()=>{requestAnimationFrame(()=>{var S,F;const e=(S=C.value)==null?void 0:S.ref,a=(F=H.value)==null?void 0:F.$el;if(!e||!a)return;const l=e.getBoundingClientRect(),{top:c,left:i,width:p,height:g}=l;let o=0,d=0;t.props.mode==="vertical"||s.level!==0?(o=c+e.scrollTop-5,d=(t.props.direction==="ltr"?i:document.documentElement.clientWidth-l.right)+p+4,o+a.offsetHeight>window.innerHeight&&(o=Math.max(0,window.innerHeight-a.offsetHeight))):(o=c+g+3,d=t.props.direction==="ltr"?i:document.documentElement.clientWidth-l.right,d-=5,o+a.offsetHeight>window.innerHeight&&(a.style.height="".concat(window.innerHeight-o,"px"))),d+a.offsetWidth>document.documentElement.clientWidth&&(d=(t.props.direction==="ltr"?i:document.documentElement.clientWidth-l.right)-p),Object.assign(a.style,{top:"".concat(o,"px"),insetInlineStart:"".concat(d,"px"),willChange:"transform",transform:"translateZ(0)"})})});else{const e=s.menu.children?t.subMenus[h].indexPath.at(-1):t.items[h].indexPath.at(-1);t.openMenu(e,t.subMenus[e].indexPath)}},300))}function L(){t.isMenuPopup&&(t.mouseInMenu=[],u==null||u(),{stop:u}=z(()=>{requestAnimationFrame(()=>{t.mouseInMenu.length===0?t.closeMenu(s.uniqueKey):m.value&&!t.mouseInMenu.includes(s.uniqueKey.at(-1))&&t.closeMenu(s.uniqueKey.at(-1))})},300))}return(e,a)=>{const l=U("SubMenu"),c=W;return f(),M(x,null,[K(J,{ref_key:"itemRef",ref:C,"unique-key":r.uniqueKey,item:r.menu,level:r.level,"sub-menu":n(m),expand:n(k),"always-expand":n(q),onClick:R,onMouseenter:$,onMouseleave:L},null,8,["unique-key","item","level","sub-menu","expand","always-expand"]),n(m)?(f(),w(j,{key:0,to:"body",disabled:!n(t).isMenuPopup},[K(O,V(n(E),N(n(A))),{default:T(()=>[n(k)?(f(),w(c,{key:0,ref_key:"subMenuRef",ref:H,scrollbar:!1,mask:n(t).isMenuPopup,class:Q(n(v)("sub-menu static h-[calc-size(auto,size)] rounded-lg will-change-transform",{"bg-[var(--g-sub-sidebar-bg)]":n(t).isMenuPopup,"border shadow-xl fixed z-3000 w-[200px]":n(t).isMenuPopup,"py-1 overscroll-contain":n(t).isMenuPopup,dark:n(t).props.dark}))},{default:T(()=>[(f(!0),M(x,null,Z(r.menu.children,i=>{var p,g,o;return f(),M(x,{key:(p=i.path)!=null?p:n(t).getUseId(i)},[((g=i.meta)==null?void 0:g.menu)!==!1?(f(),w(l,{key:0,"unique-key":[...r.uniqueKey,(o=i.path)!=null?o:n(t).getUseId(i)],menu:i,level:r.level+1},null,8,["unique-key","menu","level"])):b("",!0)],64)}),128))]),_:1},8,["mask","class"])):b("",!0)]),_:1},16)],8,["disabled"])):b("",!0)],64)}}});export{te as _};
