
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as P,s as h,n as C,a7 as j,C as k,r as s,c as H,o as S,g as e,f as B,e as r,w as o,l as J,t as O,_ as Q,i as m,L as w,h as W}from"./index-H6QnEWHf.js";import{S as X}from"./sortable.esm-DqU0xpXh.js";import{a as U}from"./table-Bw6yXVea.js";const Y={class:"form"},Z={class:"index"},ee={class:"action-bottom"},le=P({__name:"index",props:{id:{default:""}},emits:["success","cancel","preview"],setup(F,{emit:$}){const E=F,b=$,V=h("formRef"),a=C({id:E.id,name:"",code:"",border:!1,stripe:!1,header:!0,columns:[]}),I=C({name:[{required:!0,message:"请输入表格名称",trigger:"blur"}],code:[{required:!0,message:"请输入表格唯一标识",trigger:"blur"}],columns:[{validator:(n,l,d)=>{l.length===0?d(new Error("请添加列信息")):l.some(u=>u.name==="")?d(new Error("列名称不能为空")):l.some(u=>u.field==="")?d(new Error("列字段不能为空")):d()}}]}),g=h("columnsTableRef"),y=C(0);j(()=>{E.id!==""&&U.detail(E.id).then(n=>{a.value.id=n.data.id,a.value.name=n.data.name,a.value.code=n.data.code,a.value.border=n.data.border,a.value.stripe=n.data.stripe,a.value.header=n.data.header,a.value.columns=n.data.columns}),T()});function q(){a.value.columns.push({name:"",field:"",width:"100",align:"left",sortable:!1,fixed:"",enable:!0}),k(()=>{var n;(n=g.value)==null||n.setScrollTop(a.value.columns.length*50)})}function D(n){a.value.columns.splice(n,1)}function T(){var l;const n=(l=g.value)==null?void 0:l.$el.querySelector(".el-table__body-wrapper tbody");X.create(n,{handle:".sortable",animation:300,ghostClass:"ghost",onEnd:({newIndex:d,oldIndex:u})=>{if(d===void 0||u===void 0)return;const p=a.value.columns.splice(u,1)[0];a.value.columns.splice(d,0,p),y.value+=1,k(()=>T())}})}function N(){var n;(n=V.value)==null||n.validate(l=>{l&&(a.value.id===""?U.create(a.value).then(()=>{w.success("模拟新增成功"),b("success")}):U.edit(a.value).then(()=>{w.success("模拟编辑成功"),b("success")}))})}async function z(){var d,u;const n=await((d=V.value)==null?void 0:d.validateField("code",p=>{p||w.error("请先完善表格唯一标识")})),l=await((u=V.value)==null?void 0:u.validateField("columns",p=>{p||w.error("请先完善列信息")}));n&&l&&b("preview",{code:a.value.code,border:a.value.border,stripe:a.value.stripe,header:a.value.header,columns:a.value.columns})}return(n,l)=>{const d=s("ElInput"),u=s("ElFormItem"),p=s("ElCol"),v=s("ElSwitch"),G=s("ElSpace"),A=s("ElRow"),x=Q,_=s("ElButton"),f=s("ElTableColumn"),K=s("ElTag"),c=s("ElRadioButton"),R=s("ElRadioGroup"),L=s("ElTable"),M=s("ElForm");return S(),H("div",Y,[e(M,{ref_key:"formRef",ref:V,model:r(a),rules:r(I),"label-width":"100px","label-position":"top"},{default:o(()=>[e(A,{gutter:20},{default:o(()=>[e(p,{span:8},{default:o(()=>[e(u,{label:"表格名称",prop:"name"},{default:o(()=>[e(d,{modelValue:r(a).name,"onUpdate:modelValue":l[0]||(l[0]=t=>r(a).name=t),placeholder:"请输入中文描述标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:o(()=>[e(u,{label:"标识",prop:"code"},{default:o(()=>[e(d,{modelValue:r(a).code,"onUpdate:modelValue":l[1]||(l[1]=t=>r(a).code=t),placeholder:"请输入唯一标识"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:o(()=>[e(u,{label:"表格样式"},{default:o(()=>[e(G,{wrap:""},{default:o(()=>[e(v,{modelValue:r(a).border,"onUpdate:modelValue":l[2]||(l[2]=t=>r(a).border=t),"active-text":"开启边框","inactive-text":"关闭边框","inline-prompt":""},null,8,["modelValue"]),e(v,{modelValue:r(a).stripe,"onUpdate:modelValue":l[3]||(l[3]=t=>r(a).stripe=t),"active-text":"开启斑马纹","inactive-text":"关闭斑马纹","inline-prompt":""},null,8,["modelValue"]),e(v,{modelValue:r(a).header,"onUpdate:modelValue":l[4]||(l[4]=t=>r(a).header=t),"active-text":"显示表头","inactive-text":"隐藏表头","inline-prompt":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{label:"列信息",prop:"columns",class:"columns-table"},{default:o(()=>[(S(),J(L,{ref_key:"columnsTableRef",ref:g,key:r(y),data:r(a).columns,stripe:"","highlight-current-row":"",border:""},{default:o(()=>[e(f,{width:"60",align:"center",fixed:""},{header:o(()=>[e(_,{type:"primary",size:"small",circle:"",plain:"",onClick:q},{icon:o(()=>[e(x,{name:"i-ep:plus"})]),_:1})]),default:o(t=>[B("span",Z,O(t.$index+1),1),e(_,{type:"danger",size:"small",plain:"",circle:"",class:"delete",onClick:i=>D(t.$index)},{icon:o(()=>[e(x,{name:"i-ep:delete"})]),_:1},8,["onClick"])]),_:1}),e(f,{width:"80",align:"center",fixed:""},{header:o(()=>[...l[6]||(l[6]=[m(" 排序 ",-1)])]),default:o(()=>[e(K,{type:"info",class:"sortable"},{default:o(()=>[e(x,{name:"i-ep:d-caret"})]),_:1})]),_:1}),e(f,{label:"名称","min-width":"200"},{default:o(t=>[e(d,{modelValue:t.row.name,"onUpdate:modelValue":i=>t.row.name=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"字段",width:"150"},{default:o(t=>[e(d,{modelValue:t.row.field,"onUpdate:modelValue":i=>t.row.field=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"宽度",width:"120"},{default:o(t=>[e(d,{modelValue:t.row.width,"onUpdate:modelValue":i=>t.row.width=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"对齐",width:"240",align:"center"},{default:o(t=>[e(R,{modelValue:t.row.align,"onUpdate:modelValue":i=>t.row.align=i},{default:o(()=>[e(c,{value:"left"},{default:o(()=>[...l[7]||(l[7]=[m(" 左对齐 ",-1)])]),_:1}),e(c,{value:"center"},{default:o(()=>[...l[8]||(l[8]=[m(" 居中 ",-1)])]),_:1}),e(c,{value:"right"},{default:o(()=>[...l[9]||(l[9]=[m(" 右对齐 ",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"固定",width:"260",align:"center"},{default:o(t=>[e(R,{modelValue:t.row.fixed,"onUpdate:modelValue":i=>t.row.fixed=i},{default:o(()=>[e(c,{value:"left"},{default:o(()=>[...l[10]||(l[10]=[m(" 固定左侧 ",-1)])]),_:1}),e(c,{value:""},{default:o(()=>[...l[11]||(l[11]=[m(" 默认 ",-1)])]),_:1}),e(c,{value:"right"},{default:o(()=>[...l[12]||(l[12]=[m(" 固定右侧 ",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"排序",width:"80",align:"center"},{default:o(t=>[e(v,{modelValue:t.row.sortable,"onUpdate:modelValue":i=>t.row.sortable=i,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"状态",width:"80",align:"center"},{default:o(t=>[e(v,{modelValue:t.row.enable,"onUpdate:modelValue":i=>t.row.enable=i,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"]),B("div",ee,[e(_,{type:"primary",onClick:N},{default:o(()=>[...l[13]||(l[13]=[m(" 保存 ",-1)])]),_:1}),e(_,{type:"info",onClick:z},{default:o(()=>[...l[14]||(l[14]=[m(" 预览 ",-1)])]),_:1}),e(_,{onClick:l[5]||(l[5]=t=>b("cancel"))},{default:o(()=>[...l[15]||(l[15]=[m(" 取消 ",-1)])]),_:1})])])}}}),ne=W(le,[["__scopeId","data-v-c7eeae94"]]);export{ne as default};
