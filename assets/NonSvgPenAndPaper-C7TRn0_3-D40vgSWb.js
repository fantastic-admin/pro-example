
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{g as i,M as ke,Z as xe,ao as be,af as Ce,a1 as oe,c as g,o as m,O as U,U as b,n as B,l as C,w as le,k as N,p as re,a as ue,bC as se,aF as ie,R as q,S as ce}from"./index-Bnionyve.js";import{s as Ae,o as $e,u as V,f as Se,y as Fe}from"./vue-data-ui-DO-nR8BN.js";import{v as Ee}from"./ColorPicker-J5wOPCeB-D7M-gujm.js";import"./alert-Vqv_sKXu.js";import"./command.vue_vue_type_script_setup_true_lang-BupUAzs5.js";import"./index.vue_vue_type_script_setup_true_lang-BlKfdQqy.js";import"./vClickOutside-C6WiFswA-B2BXHGcD.js";const Me={class:B({"vue-ui-pen-and-paper-action":!0}),style:{padding:"0 !important"}},Be=["disabled"],De=["data-mode","xmlns","viewBox"],Ne=["cx","cy","r","fill"],Le=["d","stroke","stroke-width"],Te=["x","y","fill","font-size"],ze=["x","dy"],_e=["d","stroke","stroke-width"],Re={__name:"NonSvgPenAndPaper",props:{parent:{type:HTMLElement},backgroundColor:{type:String,default:"#FFFFFF"},color:{type:String,default:"#2D353C"},active:{type:Boolean,default:!1}},emits:["close"],setup(s,{emit:ve}){const A=s,pe=ve,k=i([]),D=i([]),Q=i("0 0 0 0"),$=i(A.color),L=i(1),y=i("draw"),p=i(null),X=i(!1),w=i(null),T=i({x:0,y:0}),S=i([""]),z=i({row:0,col:0}),F=i(16);let de=1;function Y(){return de++}function fe(a){var r;const e=x.value;if(!e)return{x:0,y:0};const t=e.createSVGPoint();let n=a.clientX,o=a.clientY;a.touches&&a.touches.length&&(n=a.touches[0].clientX,o=a.touches[0].clientY),t.x=n,t.y=o;const l=(r=e.getScreenCTM())==null?void 0:r.inverse();return l?t.matrixTransform(l):{x:0,y:0}}function G(a){if(!p.value||y.value!=="text"||X.value)return;const{x:e,y:t}=fe(a);T.value={x:e,y:t},S.value=[""],z.value={row:0,col:0};const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",e),n.setAttribute("y",t),n.setAttribute("fill",$.value),n.setAttribute("font-size",F.value),n.setAttribute("font-family","sans-serif"),n.setAttribute("class","vue-data-ui-doodle"),n.setAttribute("dominant-baseline","hanging"),n.setAttribute("pointer-events","all");const o=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.setAttribute("x",e),o.setAttribute("dy","0"),o.textContent="",n.appendChild(o),n.style.pointerEvents="none",n.style.userSelect="none",p.value.appendChild(n),w.value=n,X.value=!0,window.addEventListener("keydown",O),window.addEventListener("mousedown",I,!0),j(),H()}function O(a){if(!X.value)return;let{row:e,col:t}=z.value,n=S.value.slice(),o=!1;if(a.key==="Enter"){const l=n[e],r=l.slice(0,t),c=l.slice(t);n.splice(e,1,r,c),e+=1,t=0,o=!0,a.preventDefault()}else if(a.key==="Backspace"){if(t>0)n[e]=n[e].slice(0,t-1)+n[e].slice(t),t-=1,o=!0;else if(e>0){const l=n[e-1].length;n[e-1]+=n[e],n.splice(e,1),e-=1,t=l,o=!0}a.preventDefault()}else if(a.key==="Delete")t<n[e].length?(n[e]=n[e].slice(0,t)+n[e].slice(t+1),o=!0):e<n.length-1&&(n[e]+=n[e+1],n.splice(e+1,1),o=!0),a.preventDefault();else if(a.key==="ArrowLeft")t>0?t-=1:e>0&&(e-=1,t=n[e].length),o=!0,a.preventDefault();else if(a.key==="ArrowRight")t<n[e].length?t+=1:e<n.length-1&&(e+=1,t=0),o=!0,a.preventDefault();else if(a.key==="ArrowUp")e>0&&(e-=1,t=Math.min(t,n[e].length),o=!0),a.preventDefault();else if(a.key==="ArrowDown")e<n.length-1&&(e+=1,t=Math.min(t,n[e].length),o=!0),a.preventDefault();else if(a.key.length===1&&!a.ctrlKey&&!a.metaKey&&!a.altKey)n[e]=n[e].slice(0,t)+a.key+n[e].slice(t),t+=1,o=!0,a.preventDefault();else if(a.key==="Escape"){Z(!0);return}else a.key==="Tab"&&a.preventDefault();o&&(S.value=n,z.value={row:e,col:t},j(),H())}function j(){const a=w.value,{x:e,y:t}=T.value;for(;a.firstChild;)a.removeChild(a.firstChild);S.value.forEach((n,o)=>{const l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttribute("x",e),l.setAttribute("dy",o===0?"0":"".concat(F.value*1.2)),l.textContent=n.length?n:"​",a.appendChild(l)})}function H(){const a=p.value.querySelector(".vue-data-ui-svg-caret");a&&p.value.removeChild(a);const e=w.value;if(!e)return;const{x:t,y:n}=T.value,{row:o,col:l}=z.value,r=F.value,c=e.childNodes[o];if(!c)return;let v=c.textContent.slice(0,l);v.endsWith(" ")&&(v+=" ");const u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",t),u.setAttribute("y",n),u.setAttribute("font-size",r),u.setAttribute("font-family","sans-serif"),u.textContent=v||"",p.value.appendChild(u);const d=u.getBBox();p.value.removeChild(u);let f=n+o*r*1.2,M=t+d.width;const h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x",M),h.setAttribute("y",f),h.setAttribute("width",1),h.setAttribute("height",r),h.setAttribute("fill",$.value),h.setAttribute("class","vue-data-ui-svg-caret"),p.value.appendChild(h)}function I(a){if(w.value&&!w.value.contains(a.target)){const e=w.value.children;e.length===1&&(e[0].textContent===""||e[0].textContent==="​")&&w.value.remove(),Z(!1)}}function Z(a=!1){var n;window.removeEventListener("keydown",O),window.removeEventListener("mousedown",I,!0);const e=(n=p.value)==null?void 0:n.querySelector(".vue-data-ui-svg-caret");e&&p.value.removeChild(e);const t=S.value.every(o=>!o||o==="​");a||t||k.value.push({id:Y(),type:"text",x:T.value.x,y:T.value.y,color:$.value,fontSize:F.value,lines:S.value.map(o=>o)}),w.value&&p.value&&p.value.contains(w.value)&&p.value.removeChild(w.value),X.value=!1,w.value=null,S.value=[""],z.value={row:0,col:0}}const E=ke(()=>$e(A.color,.6));function P({width:a,height:e}){Q.value="0 0 ".concat(a," ").concat(e)}const W=i(null);xe(()=>{be(()=>{if(A.parent){W.value=new ResizeObserver(t=>{for(const n of t){const{width:o,height:l}=n.contentRect;P({width:o,height:l})}}),W.value.observe(A.parent);const{width:a,height:e}=A.parent.getBoundingClientRect();P({width:a,height:e})}}),p.value=x.value.querySelector("g")}),Ce(()=>{W.value&&W.value.disconnect()}),oe(()=>A.parent,a=>{if(!a)return;const{width:e,height:t}=A.parent.getBoundingClientRect();P({width:e,height:t})},{immediate:!0}),oe(y,a=>{var e,t;a==="text"?(e=x.value)==null||e.addEventListener("mousedown",G):(t=x.value)==null||t.removeEventListener("mousedown",G)});const _=i(!1),R=i(""),x=i(null);function J(a){if(y.value!=="draw"||!x.value)return;_.value=!0;const{x:e,y:t}=ne(a);R.value="M ".concat(e," ").concat(t)}function ee(a){if(!_.value||!x.value)return;const{x:e,y:t}=ne(a);R.value+=" ".concat(e," ").concat(t)}function te(a){const e=a.trim().split(/\s+/);if(e.length<4)return a;const t=e.slice(1).map(Number);if(t.length%2!==0)return a;const n=he(t),o=["M ".concat(n[0]," ").concat(n[1])];for(let c=2;c<n.length-2;c+=2){const v=n[c-2],u=n[c-1],d=n[c],f=n[c+1],M=(v+d)/2,h=(u+f)/2;o.push("Q ".concat(v," ").concat(u," ").concat(M," ").concat(h))}const l=n[n.length-2],r=n[n.length-1];return o.push("L ".concat(l," ").concat(r)),o.join(" ")}function he(a,e=1){const t=[...a];for(let n=2;n<a.length-2;n+=2){const o=a[n],l=a[n+1],r=a[n-2],c=a[n-1],v=a[n+2],u=a[n+3];t[n]=o+e*((r+v)/2-o),t[n+1]=l+e*((c+u)/2-l)}return t}function ge(a){const e=a.trim().split(/\s+/);let t="",n="",o=null,l=null;for(let r=0;r<e.length;r+=1){const c=e[r];if(isNaN(c)){if(n=c,n==="M"||n==="L")o=parseFloat(e[++r]),l=parseFloat(e[++r]),t+="".concat(n).concat(o," ").concat(l);else if(n==="Q"){const v=parseFloat(e[++r]),u=parseFloat(e[++r]),d=parseFloat(e[++r]),f=parseFloat(e[++r]);v===o&&u===l?t+="t".concat(d-o," ").concat(f-l):t+="q".concat(v-o," ").concat(u-l," ").concat(d-o," ").concat(f-l),o=d,l=f}}else{const v=parseFloat(c),u=parseFloat(e[++r]);if(n==="L"){const d=v-o,f=u-l;d===0?t+="v".concat(f):f===0?t+="h".concat(d):t+="l".concat(d," ").concat(f),o=v,l=u}else if(n==="Q"){const d=v,f=u,M=parseFloat(e[++r]),h=parseFloat(e[++r]);d===o&&f===l?t+="t".concat(M-o," ").concat(h-l):t+="q".concat(d-o," ").concat(f-l," ").concat(M-o," ").concat(h-l),o=M,l=h}}}return t}function K(){_.value&&(k.value.push({id:Y(),strokeWidth:L.value,path:ge(te(R.value)),color:$.value}),D.value=[],R.value=""),_.value=!1}function ne(a){if(!x.value)return{x:0,y:0};const e=x.value.getBoundingClientRect();let t,n;return a.touches&&a.touches.length?(t=a.touches[0].clientX,n=a.touches[0].clientY):(t=a.clientX,n=a.clientY),{x:t-e.left,y:n-e.top}}function me(){if(k.value.length>0){const a=k.value.pop();D.value.push(a)}}function ye(){if(D.value.length>0){const a=D.value.pop();k.value.push(a)}}function we(){k.value=[],D.value=[]}const ae=i(null);return(a,e)=>(m(),g(q,null,[s.active?(m(),g("div",{key:0,"data-dom-to-png-ignore":"",class:B({"vue-ui-pen-and-paper-actions":!0,visible:s.active}),style:b({backgroundColor:s.backgroundColor})},[C("button",{class:"vue-ui-pen-and-paper-action",style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:e[0]||(e[0]=t=>pe("close"))},[N(V,{name:"close",stroke:s.color},null,8,["stroke"])],4),C("button",Me,[N(Ee,{value:$.value,"onUpdate:value":e[1]||(e[1]=t=>$.value=t),backgroundColor:s.backgroundColor,buttonBorderColor:E.value},null,8,["value","backgroundColor","buttonBorderColor"])]),C("button",{class:B(["vue-ui-pen-and-paper-action",{"vue-ui-pen-and-paper-action-active":y.value==="text"}]),onClick:e[2]||(e[2]=t=>y.value=y.value==="text"?"draw":"text"),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)})},[N(V,{name:y.value==="draw"?"annotator":"text",stroke:s.color},null,8,["name","stroke"]),C("div",{style:b({position:"absolute",bottom:"-20px",color:E.value,width:"100%",textAlign:"center",fontSize:"12px"})},re(ue(Se)({v:y.value==="draw"?L.value:F.value,s:"px",r:1})),5)],6),C("button",{class:B({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!k.value.length}),disabled:!k.value.length,style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value),marginTop:"20px"}),onClick:me},[N(V,{name:"restart",stroke:s.color},null,8,["stroke"])],14,Be),C("button",{class:B({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!D.value.length}),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:ye},[N(V,{name:"restart",stroke:s.color,style:{transform:"scaleX(-1)"}},null,8,["stroke"])],6),C("button",{class:B([{"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!k.value.length},"vue-ui-pen-and-paper-action"]),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:we},[N(V,{name:"trash",stroke:s.color},null,8,["stroke"])],6),y.value==="draw"?le((m(),g("input",{key:0,ref_key:"range",ref:ae,type:"range",class:"vertical-range",min:.5,max:12,step:.1,"onUpdate:modelValue":e[3]||(e[3]=t=>L.value=t),style:b({accentColor:s.color})},null,4)),[[se,L.value]]):U("",!0),y.value==="text"?le((m(),g("input",{key:1,ref_key:"range",ref:ae,type:"range",class:"vertical-range",min:3,max:48,step:.1,"onUpdate:modelValue":e[4]||(e[4]=t=>F.value=t),style:b({accentColor:s.color})},null,4)),[[se,F.value]]):U("",!0)],6)):U("",!0),(m(),g("svg",{"data-mode":y.value,ref_key:"svgElement",ref:x,xmlns:ue(Fe),viewBox:Q.value,class:B({"vue-ui-pen-and-paper":!0,inactive:!s.active}),onMousedown:J,onMousemove:ee,onMouseup:K,onMouseleave:K,onTouchstart:ie(J,["prevent"]),onTouchmove:ie(ee,["prevent"]),onTouchend:K},[C("g",{ref_key:"G",ref:p},[(m(!0),g(q,null,ce(k.value,t=>(m(),g(q,{key:t.id},[t.path&&t.path.replace("M","").split(" ").length===2?(m(),g("circle",{key:0,cx:t.path.replace("M","").split(" ")[0],cy:t.path.replace("M","").split(" ")[1],r:t.strokeWidth/2,fill:t.color},null,8,Ne)):t.path?(m(),g("path",{key:1,class:"vue-ui-pen-and-paper-path",d:t.path,stroke:t.color,"stroke-width":t.strokeWidth,fill:"none"},null,8,Le)):t.type==="text"?(m(),g("text",{key:2,x:t.x,y:t.y,fill:t.color,"font-size":t.fontSize,"font-family":"sans-serif","dominant-baseline":"hanging",class:"vue-ui-pen-and-paper-text"},[(m(!0),g(q,null,ce(t.lines,(n,o)=>(m(),g("tspan",{key:o,x:t.x,dy:o===0?"0":t.fontSize*1.2},re(n.length?n:"​"),9,ze))),128))],8,Te)):U("",!0)],64))),128))],512),_.value?(m(),g("path",{key:0,class:"vue-ui-pen-and-paper-path vue-ui-pen-and-paper-path-drawing",d:te(R.value),stroke:$.value,"stroke-width":L.value*1.1,fill:"none"},null,8,_e)):U("",!0)],42,De))],64))}},Qe=Ae(Re,[["__scopeId","data-v-14478ba4"]]);export{Qe as default};
