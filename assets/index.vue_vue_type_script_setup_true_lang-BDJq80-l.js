
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as L,n as f,x as T,N as B,O as U,P as W,c as M,o as v,A as D,e as N,B as G,F as O,q as H,b as J,l as S,v as Q,C as R}from"./index-H6QnEWHf.js";import{r as X,I as Y}from"./item-BMCHnayz.js";import{_ as Z}from"./sub.vue_vue_type_script_setup_true_lang-moNed4gU.js";const ae=L({name:"MainMenu",__name:"index",props:{menu:{},value:{},accordion:{type:Boolean,default:!0},defaultOpeneds:{default:()=>[]},alwaysOpeneds:{default:()=>[]},mode:{default:"vertical"},collapse:{type:Boolean,default:!1},showCollapseName:{type:Boolean,default:!1},dark:{type:Boolean,default:!1},direction:{default:"ltr"}},setup(_){const l=_,w=new WeakMap;function d(e){return w.has(e)||w.set(e,Q()),w.get(e)}const t=f(l.value),o=f({}),c=f({}),s=f(Array.from(new Set([...l.alwaysOpeneds.slice(0),...l.defaultOpeneds.slice(0)]))),P=f(l.alwaysOpeneds.slice(0)),F=f([]),I=T(()=>l.mode==="horizontal"||l.mode==="vertical"&&l.collapse);function g(e,n=[]){e.forEach(a=>{var p,h;const u=(p=a.path)!=null?p:d(a);if((h=a.children)!=null&&h.some(i=>{var m;return((m=i.meta)==null?void 0:m.menu)!==!1})){const i=[...n,u];c.value[u]={index:u,indexPath:i,active:!1},g(a.children,i)}else o.value[u]={index:u,indexPath:n}})}const C=(e,n)=>{s.value.includes(e)||(l.accordion&&(s.value=s.value.filter(a=>n.includes(a)||P.value.includes(a))),s.value.push(e))},y=e=>{if(Array.isArray(e)){R(()=>{y(e.at(-1)),e.length>1&&y(e.slice(0,-1))});return}s.value=s.value.filter(n=>n!==e)};function q(e){var n,a;for(const u in c.value)c.value[u].active=!1;(n=c.value[e])==null||n.indexPath.forEach(u=>{c.value[u].active=!0}),(a=o.value[e])==null||a.indexPath.forEach(u=>{c.value[u].active=!0})}const A=e=>{(l.mode==="horizontal"||l.collapse)&&(s.value=[]),q(e)},$=(e,n)=>{s.value.includes(e)?y(e):C(e,n)};function x(){const e=t.value&&o.value[t.value];q(t.value),!(!e||I.value||l.collapse)&&e.indexPath.forEach(n=>{const a=c.value[n];a&&C(n,a.indexPath)})}return B(()=>l.menu,e=>{g(e),x()},{deep:!0,immediate:!0}),B(()=>l.value,e=>{o.value[e]||(t.value="");const n=o.value[e]||t.value&&o.value[t.value]||o.value[l.value];n?t.value=n.index:t.value=e,x()}),B(()=>l.collapse,e=>{e?s.value=[]:s.value=l.alwaysOpeneds.slice(0),x()}),U(X,W({props:l,getUseId:d,items:o,subMenus:c,activeIndex:t,openedMenus:s,alwaysOpenedsMenus:P,mouseInMenu:F,isMenuPopup:I,openMenu:C,closeMenu:y,handleMenuItemClick:A,handleSubMenuClick:$})),(e,n)=>(v(),M("div",{class:D(N(G)("h-full w-full flex flex-col of-hidden",{"flex-row w-auto":N(I)&&l.mode==="horizontal","py-1":l.mode==="vertical"}))},[(v(!0),M(O,null,H(_.menu,a=>{var u,p,h,i,m,E;return v(),M(O,{key:(u=a.path)!=null?u:d(a)},[((p=a.meta)==null?void 0:p.menu)!==!1?(v(),M(O,{key:0},[(h=a.children)!=null&&h.length?(v(),S(Z,{key:0,menu:a,"unique-key":[(i=a.path)!=null?i:a.children.every(k=>{var r;return((r=k.meta)==null?void 0:r.menu)===!1})?a.children[0].path:d(a)]},null,8,["menu","unique-key"])):(v(),S(Y,{key:1,item:a,"unique-key":[(E=a.path)!=null?E:(m=a.children)!=null&&m.every(k=>{var r;return((r=k.meta)==null?void 0:r.menu)===!1})?a.children[0].path:d(a)],onClick:k=>{var r,z;return A((z=a.path)!=null?z:(r=a.children)!=null&&r.every(K=>{var b;return((b=K.meta)==null?void 0:b.menu)===!1})?a.children[0].path:d(a))}},null,8,["item","unique-key","onClick"]))],64)):J("",!0)],64)}),128))],2))}});export{ae as _};
